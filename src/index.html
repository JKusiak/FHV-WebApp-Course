<!DOCTYPE html>
<html>
      <head>
            <meta charset="utf-8">
            <meta http-equiv="X-UA-Compatible" content="IE=edge">
            <title>Assignment 11</title>
            <meta name="description" content="">
            <meta name="viewport" content="width=device-width, initial-scale=1">
            <link rel="stylesheet" href="">
      </head>
      <body>
            <script src="https://d3js.org/d3.v4.min.js"></script>
            




            <script>

const casesAustriaURL = "https://api.covid19api.com/dayone/country/austria";
const activeWorldURL = "https://api.covid19api.com/summary";

const width = window.screen.width;
const height = window.screen.height;
const margin = {top: 45, right: 45, bottom: 45, left: 45};
const innerWidth = width - margin.left - margin.right;
const innerHeight = height - margin.top - margin.bottom;

// accessors
const xValue = d => d.countryName;
const yValue = d => d.activeCases;


function addCanvasSVG() {
      let canvas = d3.select("body")
      .append("svg")
            .attr("width", width)
            .attr("height", height)
      .append("g")
            .attr("transform", `translate(${margin.left}, ${margin.top})`);

      return canvas;
}

function drawBarGraph(data, canvas) {
      const xScale = d3.scaleBand()
            .domain(data.map(element => xValue(element)))
            .range([0, width])
            .padding(0.3);

      const yScale = d3.scaleLinear()
            .domain([0, d3.max(data, element => yValue(element))])
            .range([height, 0]);

      
      canvas.selectAll('rect')
            .data(data)
            .enter().append('rect')
            .attr('height', 0)
            .attr('width', xScale.bandwidth())
            .attr('y', () => yScale(0))
            .attr('x', element => xScale(xValue(element)))
            .transition()
            .duration(3000)
            .attr('height', element => yScale(yValue(element)))
            .attr('y', element => yScale(yValue(element)))
}

d3.json(activeWorldURL, (error, jsonData) => {
      const barData = jsonData.Countries.map(country => {
            return {
                  countryName: country.Country,
                  activeCases: country.TotalConfirmed - country.TotalDeaths - country.TotalRecovered
            }
      }).sort((a, b) => (b.activeCases - a.activeCases)).slice(0, 10);

      console.log(barData);
      const svgCanvas = addCanvasSVG();
      drawBarGraph(barData, svgCanvas);
});



            </script>
      </body>
</html>